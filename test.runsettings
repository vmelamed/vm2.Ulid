<?xml version="1.0" encoding="utf-8"?>
<!--
dotnet test <project> <dash dash>settings test.runsettings
For more information on using a .runsettings file, see https://aka.ms/vstest-runsettings
-->
<RunSettings>
    <RunConfiguration>
        <!--<ResultsDirectory>../../../TestArtifacts</ResultsDirectory> relative to the test project file, not the solution -->
        <CollectSourceInformation>true</CollectSourceInformation>
        <!-- 0 = use all processors; otherwise specify an integer -->
        <MaxCpuCount>0</MaxCpuCount>
    </RunConfiguration>
    <xUnit>
        <!--
        See https://xunit.net/docs/config-runsettings sort of alternative to xUnit's testConfig.json: https://xunit.net/docs/config-testconfig-json
        Instead you can use:
        dotnet test <project> <dash dash> xUnit.AppDomain=denied xUnit.ParallelizeTestCollections=false etc
        -->
        <AppDomain>denied</AppDomain>
        <!-- "required", "denied", "ifAvailable" -->
        <Culture>en-US</Culture>
        <DiagnosticMessages>false</DiagnosticMessages>
        <!-- true to enable, false to disable -->
        <InternalDiagnostics>false</InternalDiagnostics>
        <!-- true to enable, false to disable -->
        <LongRunningTestSeconds>5</LongRunningTestSeconds>
        <!-- 0 to disable -->
        <MaxParallelThreads>-1</MaxParallelThreads>
        <!--
        -1 - let xUnit decide, which is usually optimal
        0 - no parallelization
        1 - no parallelization
        2 and up - number of threads to use
        0.5x, 1.5x, 2x, etc - factor of the number of processors on t``he machine
        -->
        <AssertEquivalentMaxDepth>50</AssertEquivalentMaxDepth>
        <MethodDisplay>classAndMethod</MethodDisplay>
        <!-- method, classAndMethod -->
        <MethodDisplayOptions>none</MethodDisplayOptions>
        <!-- "all", or comma separated: "replaceUnderscoreWithSpace", "useOperatorMonikers"..., "useParameterTypes", "useEscapeSequences" Xnn or Unnnn, "replacePeriodWithComma" -->
        <NoAutoReporters>false</NoAutoReporters>
        <ParallelAlgorithm>conservative</ParallelAlgorithm>
        <!-- aggressive -->
        <ParallelizeAssembly>true</ParallelizeAssembly>
        <ParallelizeTestCollections>true</ParallelizeTestCollections>
        <PreEnumerateTheories>true</PreEnumerateTheories>
        <PrintMaxEnumerableLength>5</PrintMaxEnumerableLength>
        <PrintMaxObjectDepth>3</PrintMaxObjectDepth>
        <PrintMaxObjectMemberCount>5</PrintMaxObjectMemberCount>
        <PrintMaxStringLength>50</PrintMaxStringLength>
        <!--<seed>some integer value</seed>-->
        <ReporterSwitch>json</ReporterSwitch>
        <!-- verbose, quiet, silent, json, teamcity -->
        <!--
        In order to see the reporter output, you will need to change the verbosity level of the console reporter. In Visual Studio,
        you can do this by opening the Options settings, navigating to Test > General, and the setting the drop down under
        "Logging Level" to "Diagnostic" (the logs in Visual Studio will appear in the Output window, under "Tests"). From the
        command line, you can pass <dash dash>logger "console;verbosity=normal" on the dotnet test command line.
        -->
        <ShadowCopy>true</ShadowCopy>
        <ShowLiveOutput>false</ShowLiveOutput>
        <Explicit>off</Explicit>
        <!-- on, off, only -->
        <FailSkips>false</FailSkips>
        <FailWarns>false</FailWarns>
        <StopOnFail>false</StopOnFail>
    </xUnit>
    <!-- Configurations for data collectors -->
    <DataCollectionRunSettings>
        <DataCollectors>
            <DataCollector friendlyName="XPlat code coverage">
                <!-- https://github.com/coverlet-coverage/coverlet/blob/master/Documentation/VSTestIntegration.md -->
                <Configuration>
                    <Format>cobertura,json,lcov</Format>
                    <OutputDirectory>Coverage</OutputDirectory>
                    <FileName>coverage.cobertura.xml</FileName>
                    <!-- Exclude specific assemblies or namespaces -->
                    <!-- Exclude>[MyNamespace.*]*,[*]GeneratedCode*</Exclude -->
                    <ExcludeByAttribute>Obsolete,GeneratedCodeAttribute,ExcludeFromCodeCoverageAttribute,CompilerGeneratedAttribute,DebuggerHiddenAttribute,DebuggerNonUserCodeAttribute</ExcludeByAttribute>
                    <SkipAutoProps>true</SkipAutoProps>
                </Configuration>
            </DataCollector>
            <DataCollector friendlyName="Code Coverage" uri="datacollector://Microsoft/CodeCoverage/2.0" assemblyQualifiedName="Microsoft.VisualStudio.Coverage.DynamicCoverageDataCollector, Microsoft.VisualStudio.TraceCollector, Version=11.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a">
                <!-- https://learn.microsoft.com/en-us/visualstudio/test/customizing-code-coverage-analysis?view=vs-2022 -->
                <Configuration>
                    <Format>coverage</Format>
                    <CodeCoverage>
                        <!--
                        Additional paths to search for .pdb (symbol) files. Symbols must be found for modules to be instrumented.
                        If .pdb files are in the same folder as the .dll or .exe files, they are automatically found. Otherwise, specify them here.
                        Note that searching for symbols increases code coverage runtime. So keep this small and local.
                        -->
                        <!--
                        <SymbolSearchPaths>
                            <Path>C:\Users\username\source\repos\ProjectX</Path>
                            <Path>\\mybuildshare\builds\ProjectX</Path>
                        </SymbolSearchPaths>
                        -->
                        <!--
                        About include/exclude lists:
                        Empty "Include" clauses imply all; empty "Exclude" clauses imply none.
                        Each element in the list is a regular expression (ECMAScript syntax). See /visualstudio/ide/using-regular-expressions-in-visual-studio.
                        An item must first match at least one entry in the include list to be included.
                        Included items must then not match any entries in the exclude list to remain included.
                        -->
                        <!-- Match assembly file paths: -->
                        <ModulePaths>
                            <!-- Specify the file name patterns of the binaries to be instrumented: -->
                            <!--
                            <Include>
                                <ModulePath>.*\.dll$</ModulePath>
                                <ModulePath>.*\.exe$</ModulePath>
                            </Include>
                            <Exclude>
                                <ModulePath>.*CPPUnitTestFramework.*</ModulePath>
                            </Exclude>
                            -->
                            <!-- Specifies additional list of directories where binaries static native instrumentation should be searched. -->
                            <!--
                            <IncludeDirectories>
                                <Directory Recursive="true">C:\b59fb11c-1611-4562-9a2b-c35719da65d3</Directory>
                            </IncludeDirectories>
                            -->
                        </ModulePaths>

                        <!-- Match fully qualified names of functions: -->
                        <!-- (Use "\." to delimit namespaces in C# or Visual Basic, "::" in C++.)  -->
                        <!--
                        <Functions>
                            <Exclude>
                                <Function>^Fabrikam\.UnitTest\..*</Function>
                            </Exclude>
                        </Functions>
                        -->

                        <!-- Match the path of the source files in which each method is defined: -->
                        <!--
                        <Sources>
                            <Exclude>
                                <Source>.*\\atlmfc\\.*</Source>
                                <Source>.*\\vctools\\.*</Source>
                                <Source>.*\\public\\sdk\\.*</Source>
                                <Source>.*\\microsoft sdks\\.*</Source>
                                <Source>.*\\vc\\include\\.*</Source>
                            </Exclude>
                        </Sources>
                        -->

                        <!-- Match the company name property in the assembly: -->
                        <CompanyNames>
                            <Exclude>
                                <CompanyName>.*microsoft.*</CompanyName>
                            </Exclude>
                        </CompanyNames>

                        <!-- Match the public key token of a signed assembly: -->
                        <PublicKeyTokens>
                            <!-- Exclude Visual Studio extensions: -->
                            <!--
                            <Exclude>
                                <PublicKeyToken>^B77A5C561934E089$</PublicKeyToken>
                                <PublicKeyToken>^B03F5F7F11D50A3A$</PublicKeyToken>
                                <PublicKeyToken>^31BF3856AD364E35$</PublicKeyToken>
                                <PublicKeyToken>^89845DCD8080CC91$</PublicKeyToken>
                                <PublicKeyToken>^71E9BCE111E9429C$</PublicKeyToken>
                                <PublicKeyToken>^8F50407C4E9E73B6$</PublicKeyToken>
                                <PublicKeyToken>^E361AF139669C375$</PublicKeyToken>
                            </Exclude>
                            -->
                        </PublicKeyTokens>

                        <!-- Match attributes on any code element: -->
                        <Attributes>
                            <Exclude>
                                <!-- Don't forget "Attribute" at the end of the name -->
                                <Attribute>^System\.Diagnostics\.DebuggerHiddenAttribute$</Attribute>
                                <Attribute>^System\.Diagnostics\.DebuggerNonUserCodeAttribute$</Attribute>
                                <Attribute>^System\.CodeDom\.Compiler\.GeneratedCodeAttribute$</Attribute>
                                <Attribute>^System\.Diagnostics\.CodeAnalysis\.ExcludeFromCodeCoverageAttribute$</Attribute>
                            </Exclude>
                        </Attributes>

                        <!-- We recommend you do not change the following values: -->

                        <!-- Set this to True to collect coverage information for functions marked with the "SecuritySafeCritical" attribute. Instead of writing directly into a memory location from such functions, code coverage inserts a probe that redirects to another function, which in turns writes into memory. -->
                        <UseVerifiableInstrumentation>True</UseVerifiableInstrumentation>
                        <!-- When set to True, collects coverage information from child processes that are launched with low-level ACLs, for example, UWP apps. -->
                        <AllowLowIntegrityProcesses>True</AllowLowIntegrityProcesses>
                        <!-- When set to True, collects coverage information from child processes that are launched by test or production code. -->
                        <CollectFromChildProcesses>True</CollectFromChildProcesses>
                        <!-- When set to True, restarts the IIS process and collects coverage information from it. -->
                        <CollectAspDotNet>False</CollectAspDotNet>
                        <!-- When set to True, static native instrumentation will be enabled. -->
                        <EnableStaticNativeInstrumentation>True</EnableStaticNativeInstrumentation>
                        <!-- When set to True, dynamic native instrumentation will be enabled. -->
                        <EnableDynamicNativeInstrumentation>True</EnableDynamicNativeInstrumentation>
                        <!-- When set to True, instrumented binaries on disk are removed and original files are restored. -->
                        <EnableStaticNativeInstrumentationRestore>True</EnableStaticNativeInstrumentationRestore>
                        <!-- When set to False, test assemblies will not be added to the coverage report. -->
                        <IncludeTestAssembly>True</IncludeTestAssembly>
                    </CodeCoverage>
                </Configuration>
            </DataCollector>
        </DataCollectors>
    </DataCollectionRunSettings>
</RunSettings>
